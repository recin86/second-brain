import{r as a,u as N,j as h,d as p}from"./index-DlL53pBI.js";import{c as D}from"./CategoryChangeModal-BZYjauhF.js";const R=(e,r={})=>{const{threshold:s=100,preventScrollOnSwipe:c=!1}=r,[l,m]=a.useState(!1),[t,b]=a.useState(null),[o,f]=a.useState(null),[i,d]=a.useState(!1),w=a.useCallback(u=>{if(u.touches.length!==1)return;const g=u.touches[0],n={x:g.clientX,y:g.clientY};m(!0),b(n),f(n),d(!1),e.onSwipeStart?.()},[e]),S=a.useCallback(u=>{if(!l||!t||u.touches.length!==1)return;const g=u.touches[0],n={x:g.clientX,y:g.clientY},x=Math.abs(n.x-t.x),k=Math.abs(n.y-t.y);x>k&&x>10&&(d(!0),c&&u.preventDefault()),f(n)},[l,t,c]),y=a.useCallback(()=>{if(!l||!t||!o){m(!1),b(null),f(null),d(!1);return}const u=o.x-t.x,g=Math.abs(o.y-t.y);Math.abs(u)>s&&Math.abs(u)>g&&(u>0?e.onSwipeRight?.():e.onSwipeLeft?.()),m(!1),b(null),f(null),d(!1),e.onSwipeEnd?.()},[l,t,o,s,e]),v=a.useCallback(()=>!t||!o?0:o.x-t.x,[t,o]),C=a.useCallback(()=>{const u=Math.abs(v());return Math.min(u/s,1)},[v,s]);return{swipeHandlers:{onTouchStart:w,onTouchMove:S,onTouchEnd:y,onTouchCancel:y},isDragging:i,isPressed:l,getSwipeDistance:v,getSwipeProgress:C,swipeDirection:t&&o?o.x>t.x?"right":"left":null}},K=(e,r={})=>{const{threshold:s=500,onStart:c,onFinish:l,onCancel:m}=r,[t,b]=a.useState(!1),o=a.useRef(null),f=a.useRef(null),i=a.useCallback((n,x)=>{b(!0),f.current={x:n,y:x},c?.(),o.current=setTimeout(()=>{e(),l?.(),b(!1)},s)},[e,s,c,l]),d=a.useCallback((n=!0)=>{o.current&&(clearTimeout(o.current),o.current=null),t&&n&&m?.(),b(!1),f.current=null},[t,m]),w=a.useCallback((n,x)=>{if(!f.current)return;const k=10,T=Math.abs(n-f.current.x),E=Math.abs(x-f.current.y);(T>k||E>k)&&d(!0)},[d]),S=a.useCallback(n=>{n.preventDefault(),i(n.clientX,n.clientY)},[i]),y=a.useCallback(()=>{d(!0)},[d]),v=a.useCallback(n=>{t&&w(n.clientX,n.clientY)},[t,w]),C=a.useCallback(()=>{d(!0)},[d]),j=a.useCallback(n=>{if(n.touches.length===1){const x=n.touches[0];i(x.clientX,x.clientY)}},[i]),u=a.useCallback(()=>{d(!0)},[d]),g=a.useCallback(n=>{if(t&&n.touches.length===1){const x=n.touches[0];w(x.clientX,x.clientY)}},[t,w]);return{isPressed:t,handlers:{onMouseDown:S,onMouseUp:y,onMouseMove:v,onMouseLeave:C,onTouchStart:j,onTouchEnd:u,onTouchMove:g}}},L=({isOpen:e,title:r,initialContent:s,onSave:c,onClose:l})=>{const{t:m}=N(),[t,b]=a.useState(s);a.useEffect(()=>{b(s)},[s,e]);const o=()=>{t.trim()&&(c(t.trim()),l())},f=i=>{i.key==="Escape"&&l(),(i.ctrlKey||i.metaKey)&&i.key==="Enter"&&o()};return e?h.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[h.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:l}),h.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 max-h-[80vh] flex flex-col",children:[h.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[h.jsxs("h2",{className:"text-xl font-bold text-primary",children:["✏️ ",r]}),h.jsx("button",{onClick:l,className:"text-muted hover:text-red-600 text-2xl w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:"×"})]}),h.jsxs("div",{className:"flex-1 p-6",children:[h.jsx("textarea",{value:t,onChange:i=>b(i.target.value),onKeyDown:f,placeholder:"내용을 입력하세요...",className:"w-full h-64 p-4 border border-gray-200 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),h.jsx("div",{className:"mt-4 text-sm text-muted",children:h.jsx("span",{children:"💡 Ctrl+Enter로 저장, Esc로 취소"})})]}),h.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[h.jsx("button",{onClick:l,className:"btn btn-secondary",children:"취소"}),h.jsx("button",{onClick:o,disabled:!t.trim(),className:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"저장"})]})]})]}):null};async function z(e,r,s){const c=D(s);return c.type===r?(await M(e.id,r,c),{converted:!1}):(await P(e.id,r,c.type,c),{converted:!0,newType:c.type})}async function M(e,r,s){switch(r){case"thought":await p.updateThought(e,{content:s.content});break;case"todo":await p.updateTodo(e,{content:s.content,...s.dueDate&&{dueDate:s.dueDate}});break;case"radiology":await p.updateRadiologyNote(e,{content:s.content,...s.tags&&{tags:s.tags}});break;case"investment":await p.updateInvestment(e,{content:s.content});break}}async function P(e,r,s,c){switch(s){case"thought":await p.convertToThought(e,r);break;case"todo":await p.convertToTodo(e,r);break;case"radiology":await p.convertToRadiology(e,r);break;case"investment":await p.convertToInvestment(e,r);break}await M(e,s,c)}export{L as E,K as a,z as s,R as u};
