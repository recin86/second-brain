import{u as K,a as R,r as i,d,j as e}from"./index-CpoK_CYL.js";import{u as G,a as w,i as Q,g as X,C as _,b as H}from"./CategoryChangeModal-DcJAKWMq.js";import{E as U,u as q,a as z,s as B}from"./smartEdit-BPExGv78.js";const Y=()=>{const{t:r}=K(),{showUndo:b}=R(),[N,C]=i.useState([]),[y,T]=i.useState(""),[u,f]=i.useState({}),[S,l]=i.useState(!1),[m,c]=i.useState(""),[E,h]=i.useState(!1),[p,g]=i.useState(null),{toggleCardExpansion:D,isExpanded:M}=G();i.useEffect(()=>{const t=d.subscribeToThoughts(a=>{C(a);const s={};a.forEach(o=>{const x=w(o.createdAt);s[x]=!0}),f(o=>({...o,...s}))});return()=>{t()}},[]);const k=N.filter(t=>t.content.toLowerCase().includes(y.toLowerCase())),j=async(t,a=!1)=>{if(!(!a&&!window.confirm(r("thoughts.delete_confirm"))))try{const s=await d.softDeleteThought(t);b("생각이 삭제되었습니다",s)}catch(s){console.error("Failed to delete thought:",s)}},O=t=>{g(t),h(!0)},L=async t=>{if(p)try{const a=await B(p,"thought",t);h(!1),g(null),a.converted&&b(`생각이 ${I(a.newType)}로 변환되었습니다`,()=>{})}catch(a){console.error("Failed to update thought:",a)}},I=t=>{switch(t){case"todo":return"할 일";case"radiology":return"영상의학";case"investment":return"투자";default:return t}},F=async t=>{if(m)try{switch(t){case"todo":await d.convertToTodo(m,"thought");break;case"investment":await d.convertToInvestment(m,"thought");break;case"radiology":await d.convertToRadiology(m,"thought");break}l(!1),c("")}catch(a){console.error("Failed to convert category:",a)}},v=k.reduce((t,a)=>{const s=w(a.createdAt);return t[s]||(t[s]=[]),t[s].push(a),t},{});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xl sm:text-2xl",children:"💭"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:r("thoughts.title")}),e.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:r("thoughts.subtitle")})]})]}),e.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-muted text-lg sm:text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:y,onChange:t=>T(t.target.value),placeholder:r("thoughts.search"),className:"w-full text-base sm:text-lg border-0 bg-transparent focus:outline-none placeholder-gray-400 text-primary"})]})})]})}),Object.keys(v).length===0?e.jsxs("div",{className:"card text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:r("thoughts.empty")}),e.jsx("p",{className:"text-muted text-base",children:r("thoughts.empty_subtitle")})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(v).sort(([t],[a])=>new Date(a).getTime()-new Date(t).getTime()).map(([t,a])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold mr-2 text-primary",children:t}),e.jsxs("span",{className:"badge",children:[a.length,r("thoughts.count")]}),e.jsx("button",{onClick:()=>f(s=>({...s,[t]:!s[t]})),className:"ml-4 btn-outline p-2 rounded-lg","aria-label":u[t]?r("thoughts.collapse"):r("thoughts.expand"),children:u[t]?"🔼":"🔽"})]}),u[t]&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(s=>{const o=Q(s.content),x=M(s.id),$=o&&!x?X(s.content):s.content,P=()=>{const n=q({onSwipeLeft:()=>j(s.id,!0),onSwipeRight:()=>{c(s.id),l(!0)}},{threshold:100,preventScrollOnSwipe:!0}),A=z(()=>{c(s.id),l(!0)},{threshold:500});return e.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${n.isDragging?n.swipeDirection==="left"?"bg-red-50 border-red-200":n.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""}`,style:{transform:n.isDragging?`translateX(${Math.min(Math.max(n.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},...n.swipeHandlers,...A.handlers,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>{c(s.id),l(!0)},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"💭 생각"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>O(s),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit thought",title:"수정",children:"✏️"}),e.jsx("button",{onClick:()=>j(s.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete thought",children:"🗑️"})]})]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"pr-8 flex-1",children:[e.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:$}),o&&e.jsx("button",{onClick:()=>D(s.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:x?"접기":"...더보기"})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-xs text-gray-500",children:H(s.createdAt)})})]}),n.isDragging&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${n.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${n.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},s.id)};return e.jsx(P,{},s.id)})})]},t))}),e.jsx(_,{isOpen:S,currentCategory:"thought",onCategorySelect:F,onClose:()=>{l(!1),c("")}}),e.jsx(U,{isOpen:E,title:"생각 수정",initialContent:p?.content||"",onSave:L,onClose:()=>{h(!1),g(null)}})]})};export{Y as ThoughtsPage};
