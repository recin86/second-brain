import{u as L,a as O,r as o,d,j as e}from"./index-DSKgOtBR.js";import{u as I,a as y,i as F,g as P,C as $,b as A}from"./CategoryChangeModal-CVKOeupr.js";import{u as K,a as R}from"./useLongPress-B6GBr61G.js";const _=()=>{const{t:r}=L(),{showUndo:f}=O(),[j,v]=o.useState([]),[u,w]=o.useState(""),[h,p]=o.useState({}),[N,l]=o.useState(!1),[m,c]=o.useState(""),{toggleCardExpansion:C,isExpanded:S}=I();o.useEffect(()=>{const s=d.subscribeToThoughts(a=>{v(a);const t={};a.forEach(i=>{const x=y(i.createdAt);t[x]=!0}),p(i=>({...i,...t}))});return()=>{s()}},[]);const T=j.filter(s=>s.content.toLowerCase().includes(u.toLowerCase())),g=async(s,a=!1)=>{if(!(!a&&!window.confirm(r("thoughts.delete_confirm"))))try{const t=await d.softDeleteThought(s);f("생각이 삭제되었습니다",t)}catch(t){console.error("Failed to delete thought:",t)}},D=async s=>{if(m)try{switch(s){case"todo":await d.convertToTodo(m,"thought");break;case"investment":await d.convertToInvestment(m,"thought");break;case"radiology":await d.convertToRadiology(m,"thought");break}l(!1),c("")}catch(a){console.error("Failed to convert category:",a)}},b=T.reduce((s,a)=>{const t=y(a.createdAt);return s[t]||(s[t]=[]),s[t].push(a),s},{});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xl sm:text-2xl",children:"💭"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:r("thoughts.title")}),e.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:r("thoughts.subtitle")})]})]}),e.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-muted text-lg sm:text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:u,onChange:s=>w(s.target.value),placeholder:r("thoughts.search"),className:"w-full text-base sm:text-lg border-0 bg-transparent focus:outline-none placeholder-gray-400 text-primary"})]})})]})}),Object.keys(b).length===0?e.jsxs("div",{className:"card text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:r("thoughts.empty")}),e.jsx("p",{className:"text-muted text-base",children:r("thoughts.empty_subtitle")})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(b).sort(([s],[a])=>new Date(a).getTime()-new Date(s).getTime()).map(([s,a])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold mr-2 text-primary",children:s}),e.jsxs("span",{className:"badge",children:[a.length,r("thoughts.count")]}),e.jsx("button",{onClick:()=>p(t=>({...t,[s]:!t[s]})),className:"ml-4 btn-outline p-2 rounded-lg","aria-label":h[s]?r("thoughts.collapse"):r("thoughts.expand"),children:h[s]?"🔼":"🔽"})]}),h[s]&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(t=>{const i=F(t.content),x=S(t.id),E=i&&!x?P(t.content):t.content,k=()=>{const n=K({onSwipeLeft:()=>g(t.id,!0),onSwipeRight:()=>{c(t.id),l(!0)}},{threshold:100,preventScrollOnSwipe:!0}),M=R(()=>{c(t.id),l(!0)},{threshold:500});return e.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${n.isDragging?n.swipeDirection==="left"?"bg-red-50 border-red-200":n.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""}`,style:{transform:n.isDragging?`translateX(${Math.min(Math.max(n.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},...n.swipeHandlers,...M.handlers,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>{c(t.id),l(!0)},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"💭 생각"}),e.jsx("div",{className:"badge",children:A(t.createdAt)})]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"pr-8 flex-1",children:[e.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:E}),i&&e.jsx("button",{onClick:()=>C(t.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:x?"접기":"...더보기"})]}),e.jsx("button",{onClick:()=>g(t.id),className:"absolute top-4 right-4 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete thought",children:"🗑️"})]})]}),n.isDragging&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${n.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${n.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},t.id)};return e.jsx(k,{},t.id)})})]},s))}),e.jsx($,{isOpen:N,currentCategory:"thought",onCategorySelect:D,onClose:()=>{l(!1),c("")}})]})};export{_ as ThoughtsPage};
