import{u as X,a as B,r,d as c,j as e}from"./index-CkiIdOd7.js";import{u as H,i as U,g as q,C as J,b as K}from"./CategoryChangeModal-mVw1092v.js";import{E as Q,u as V,a as W,s as Y}from"./smartEdit-BzseLFlM.js";const se=()=>{const{t:n}=X(),{showUndo:g}=B(),[j,S]=r.useState([]),[d,C]=r.useState(""),[E,I]=r.useState(!0),[k,m]=r.useState(!1),[x,u]=r.useState(""),[D,b]=r.useState(!1),[f,y]=r.useState(null),[o,h]=r.useState(!1),[i,p]=r.useState(new Set),{toggleCardExpansion:T,isExpanded:$}=H();r.useEffect(()=>{const t=c.subscribeToInvestments(s=>{S(s),I(!1)});return()=>t()},[]);const M=t=>{y(t),b(!0)},L=async t=>{if(f)try{const s=await Y(f,"investment",t);b(!1),y(null),s.converted&&g(`투자 기록이 ${z(s.newType)}로 변환되었습니다`,()=>{})}catch(s){console.error("Failed to update investment:",s)}},z=t=>{switch(t){case"thought":return"생각";case"todo":return"할 일";case"radiology":return"영상의학";default:return t}},w=async(t,s=!1)=>{if(!(!s&&!window.confirm(n("investments.delete_confirm"))))try{const a=await c.softDeleteInvestment(t);g("투자 기록이 삭제되었습니다",a)}catch(a){console.error("Failed to delete investment:",a)}},F=async t=>{if(x)try{switch(t){case"thought":await c.convertToThought(x,"investment");break;case"todo":await c.convertToTodo(x,"investment");break;case"radiology":await c.convertToRadiology(x,"investment");break}m(!1),u("")}catch(s){console.error("Failed to convert category:",s)}},N=t=>{o&&p(s=>{const a=new Set(s);return a.has(t)?(a.delete(t),a.size===0&&h(!1)):a.add(t),a})},O=async()=>{if(i.size!==0&&window.confirm(`선택한 ${i.size}개의 항목을 삭제하시겠습니까?`))try{const t=Array.from(i).map(a=>c.softDeleteInvestment(a)),s=await Promise.all(t);g(`${i.size}개의 투자 기록이 삭제되었습니다`,()=>{s.forEach(a=>a())}),p(new Set),h(!1)}catch(t){console.error("Failed to delete selected investments:",t)}},P=()=>{h(!1),p(new Set)},v=j.filter(t=>t.content.toLowerCase().includes(d.toLowerCase()));return E?e.jsx("div",{className:"container mx-auto px-8 py-12",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-primary/20 rounded-2xl mx-auto mb-4 flex items-center justify-center animate-pulse",children:e.jsx("span",{className:"text-3xl",children:"💰"})}),e.jsx("p",{className:"text-muted",children:"Loading..."})]})})}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xl sm:text-2xl",children:"💰"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:n("investments.title")}),e.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:n("investments.subtitle")})]})]}),o&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-white text-sm sm:text-base",children:[i.size,"개 선택됨"]}),e.jsx("button",{onClick:P,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm transition-colors",children:"취소"}),e.jsxs("button",{onClick:O,disabled:i.size===0,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-500 rounded-lg text-sm transition-colors",children:["삭제 (",i.size,")"]})]})]}),e.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:d,onChange:t=>C(t.target.value),placeholder:n("investments.search"),className:"w-full px-4 py-3 text-base border-0 bg-transparent focus:outline-none placeholder-gray-400 text-primary"}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("span",{className:"text-xl text-muted",children:"🔍"})})]})})]})}),e.jsx("div",{className:"flex items-center justify-between mb-6 sm:mb-8",children:e.jsx("h2",{className:"text-lg sm:text-2xl font-semibold",children:d?`검색 결과 (${v.length}${n("investments.count")})`:`전체 (${j.length}${n("investments.count")})`})}),v.length===0?e.jsxs("div",{className:"text-center py-12 sm:py-16",children:[e.jsx("div",{className:"w-16 h-16 sm:w-24 sm:h-24 bg-primary/10 rounded-2xl mx-auto mb-4 sm:mb-6 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl sm:text-4xl",children:"💰"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3",children:n(d?"search.no_results":"investments.empty_all")}),e.jsx("p",{className:"text-muted text-base sm:text-lg px-4",children:n(d?"search.no_results_subtitle":"investments.empty_subtitle")})]}):e.jsx("div",{className:"space-y-6",children:v.map(t=>{const s=U(t.content),a=$(t.id),_=s&&!a?q(t.content):t.content,R=()=>{const l=V({onSwipeLeft:()=>w(t.id,!0),onSwipeRight:()=>{u(t.id),m(!0)}},{threshold:100,preventScrollOnSwipe:!0}),A=W(()=>{o||(h(!0),p(new Set([t.id])))},{threshold:500});return e.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${l.isDragging?l.swipeDirection==="left"?"bg-red-50 border-red-200":l.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""} ${o&&i.has(t.id)?"ring-2 ring-blue-500 bg-blue-50":""}`,style:{transform:l.isDragging?`translateX(${Math.min(Math.max(l.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},onClick:()=>N(t.id),...o?{}:l.swipeHandlers,...A.handlers,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[o&&e.jsx("input",{type:"checkbox",checked:i.has(t.id),onChange:()=>N(t.id),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("button",{onClick:G=>{G.stopPropagation(),o||(u(t.id),m(!0))},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"💰 투자"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>M(t),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit investment",title:"수정",children:"✏️"}),e.jsx("button",{onClick:()=>w(t.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete investment",children:"🗑️"})]})]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 pr-8",children:[e.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:_}),s&&e.jsx("button",{onClick:()=>T(t.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:a?"접기":"...더보기"})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-xs text-gray-500",children:K(t.createdAt)})})]}),l.isDragging&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${l.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${l.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},t.id)};return e.jsx(R,{},t.id)})}),e.jsx(J,{isOpen:k,currentCategory:"investment",onCategorySelect:F,onClose:()=>{m(!1),u("")}}),e.jsx(Q,{isOpen:D,title:"투자 기록 수정",initialContent:f?.content||"",onSave:L,onClose:()=>{b(!1),y(null)}})]})};export{se as InvestmentsPage};
