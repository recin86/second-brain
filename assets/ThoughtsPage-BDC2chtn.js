import{u as H,a as U,r,d,j as e}from"./index-CkiIdOd7.js";import{u as q,a as E,i as J,g as V,C as W,b as Y}from"./CategoryChangeModal-mVw1092v.js";import{E as Z,u as ee,a as te,s as se}from"./smartEdit-BzseLFlM.js";const ie=()=>{const{t:n}=H(),{showUndo:b}=U(),[k,D]=r.useState([]),[v,M]=r.useState(""),[f,N]=r.useState({}),[O,x]=r.useState(!1),[m,u]=r.useState(""),[$,y]=r.useState(!1),[j,w]=r.useState(null),[l,h]=r.useState(!1),[i,p]=r.useState(new Set),{toggleCardExpansion:z,isExpanded:F}=q();r.useEffect(()=>{const s=d.subscribeToThoughts(a=>{D(a);const t={};a.forEach(c=>{const g=E(c.createdAt);t[g]=!0}),N(c=>({...c,...t}))});return()=>{s()}},[]);const L=k.filter(s=>s.content.toLowerCase().includes(v.toLowerCase())),S=async(s,a=!1)=>{if(!(!a&&!window.confirm(n("thoughts.delete_confirm"))))try{const t=await d.softDeleteThought(s);b("생각이 삭제되었습니다",t)}catch(t){console.error("Failed to delete thought:",t)}},P=s=>{w(s),y(!0)},I=async s=>{if(j)try{const a=await se(j,"thought",s);y(!1),w(null),a.converted&&b(`생각이 ${A(a.newType)}로 변환되었습니다`,()=>{})}catch(a){console.error("Failed to update thought:",a)}},A=s=>{switch(s){case"todo":return"할 일";case"radiology":return"영상의학";case"investment":return"투자";default:return s}},K=async s=>{if(m)try{switch(s){case"todo":await d.convertToTodo(m,"thought");break;case"investment":await d.convertToInvestment(m,"thought");break;case"radiology":await d.convertToRadiology(m,"thought");break}x(!1),u("")}catch(a){console.error("Failed to convert category:",a)}},C=s=>{l&&p(a=>{const t=new Set(a);return t.has(s)?(t.delete(s),t.size===0&&h(!1)):t.add(s),t})},R=async()=>{if(i.size!==0&&window.confirm(`선택한 ${i.size}개의 항목을 삭제하시겠습니까?`))try{const s=Array.from(i).map(t=>d.softDeleteThought(t)),a=await Promise.all(s);b(`${i.size}개의 생각이 삭제되었습니다`,()=>{a.forEach(t=>t())}),p(new Set),h(!1)}catch(s){console.error("Failed to delete selected thoughts:",s)}},G=()=>{h(!1),p(new Set)},T=L.reduce((s,a)=>{const t=E(a.createdAt);return s[t]||(s[t]=[]),s[t].push(a),s},{});return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[e.jsx("div",{className:"mb-6 sm:mb-8",children:e.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xl sm:text-2xl",children:"💭"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:n("thoughts.title")}),e.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:n("thoughts.subtitle")})]})]}),l&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-white text-sm sm:text-base",children:[i.size,"개 선택됨"]}),e.jsx("button",{onClick:G,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm transition-colors",children:"취소"}),e.jsxs("button",{onClick:R,disabled:i.size===0,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-500 rounded-lg text-sm transition-colors",children:["삭제 (",i.size,")"]})]})]}),e.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-muted text-lg sm:text-xl",children:"🔍"}),e.jsx("input",{type:"text",value:v,onChange:s=>M(s.target.value),placeholder:n("thoughts.search"),className:"w-full text-base sm:text-lg border-0 bg-transparent focus:outline-none placeholder-gray-400 text-primary"})]})})]})}),Object.keys(T).length===0?e.jsxs("div",{className:"card text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:n("thoughts.empty")}),e.jsx("p",{className:"text-muted text-base",children:n("thoughts.empty_subtitle")})]}):e.jsx("div",{className:"space-y-8",children:Object.entries(T).sort(([s],[a])=>new Date(a).getTime()-new Date(s).getTime()).map(([s,a])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold mr-2 text-primary",children:s}),e.jsxs("span",{className:"badge",children:[a.length,n("thoughts.count")]}),e.jsx("button",{onClick:()=>N(t=>({...t,[s]:!t[s]})),className:"ml-4 btn-outline p-2 rounded-lg","aria-label":f[s]?n("thoughts.collapse"):n("thoughts.expand"),children:f[s]?"🔼":"🔽"})]}),f[s]&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(t=>{const c=J(t.content),g=F(t.id),Q=c&&!g?V(t.content):t.content,X=()=>{const o=ee({onSwipeLeft:()=>S(t.id,!0),onSwipeRight:()=>{u(t.id),x(!0)}},{threshold:100,preventScrollOnSwipe:!0}),_=te(()=>{l||(h(!0),p(new Set([t.id])))},{threshold:500});return e.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${o.isDragging?o.swipeDirection==="left"?"bg-red-50 border-red-200":o.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""} ${l&&i.has(t.id)?"ring-2 ring-blue-500 bg-blue-50":""}`,style:{transform:o.isDragging?`translateX(${Math.min(Math.max(o.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},onClick:()=>C(t.id),...l?{}:o.swipeHandlers,..._.handlers,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[l&&e.jsx("input",{type:"checkbox",checked:i.has(t.id),onChange:()=>C(t.id),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("button",{onClick:B=>{B.stopPropagation(),l||(u(t.id),x(!0))},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"💭 생각"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>P(t),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit thought",title:"수정",children:"✏️"}),e.jsx("button",{onClick:()=>S(t.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete thought",children:"🗑️"})]})]}),e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"pr-8 flex-1",children:[e.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:Q}),c&&e.jsx("button",{onClick:()=>z(t.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:g?"접기":"...더보기"})]})}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("div",{className:"text-xs text-gray-500",children:Y(t.createdAt)})})]}),o.isDragging&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${o.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${o.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},t.id)};return e.jsx(X,{},t.id)})})]},s))}),e.jsx(W,{isOpen:O,currentCategory:"thought",onCategorySelect:K,onClose:()=>{x(!1),u("")}}),e.jsx(Z,{isOpen:$,title:"생각 수정",initialContent:j?.content||"",onSave:I,onClose:()=>{y(!1),w(null)}})]})};export{ie as ThoughtsPage};
