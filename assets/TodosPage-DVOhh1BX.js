import{u as M,a as O,r as m,d as l,j as t}from"./index-DSKgOtBR.js";import{u as _,i as B,g as z,C as G,b as j}from"./CategoryChangeModal-CVKOeupr.js";import{u as U,a as X}from"./useLongPress-B6GBr61G.js";function q(o,h){let n;return function(...g){const c=this,y=()=>{n=null,o.apply(c,g)};n&&clearTimeout(n),n=setTimeout(y,h)}}const W=()=>{const{t:o}=M(),{showUndo:h}=O(),[n,g]=m.useState([]),[c,y]=m.useState("all"),[C,u]=m.useState(!1),[x,p]=m.useState(""),{toggleCardExpansion:N,isExpanded:T}=_();m.useEffect(()=>{const e=l.subscribeToTodos(g);return()=>e()},[]);const k=e=>{const r=n.find(i=>i.id===e);r&&l.updateTodo(e,{isCompleted:!r.isCompleted})},D=m.useRef(q((e,r)=>{l.updateTodo(e,r)},500)),S=(e,r)=>{const i=r.target.value?new Date(r.target.value):void 0;D.current(e,{dueDate:i})},$=(e,r)=>{const i=["low","medium","high"],f=(i.indexOf(r)+1)%i.length;l.updateTodo(e,{priority:i[f]})},b=async(e,r=!1)=>{if(!(!r&&!window.confirm(o("todos.delete_confirm"))))try{const i=await l.softDeleteTodo(e);h("할 일이 삭제되었습니다",i)}catch(i){console.error("Failed to delete todo:",i)}},I=async e=>{if(x)try{switch(e){case"thought":await l.convertToThought(x,"todo");break;case"investment":await l.convertToInvestment(x,"todo");break;case"radiology":await l.convertToRadiology(x,"todo");break}u(!1),p("")}catch(r){console.error("Failed to convert category:",r)}},w=n.filter(e=>c==="pending"?!e.isCompleted:c==="completed"?e.isCompleted:!0),P=[...w].sort((e,r)=>e.isCompleted===r.isCompleted?r.createdAt.getTime()-e.createdAt.getTime():e.isCompleted?1:-1),F=n.filter(e=>!e.isCompleted).length,E=n.filter(e=>e.isCompleted).length,A=e=>{switch(e){case"high":return"bg-red-600 hover:bg-red-700 text-white border-red-700";case"medium":return"btn-secondary";case"low":return"btn-accent";default:return"text-date"}},L=e=>{switch(e){case"high":return o("todos.priority.high");case"medium":return o("todos.priority.medium");case"low":return o("todos.priority.low");default:return o("todos.priority.medium")}};return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[t.jsx("div",{className:"mb-6 sm:mb-8",children:t.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[t.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:t.jsx("span",{className:"text-xl sm:text-2xl",children:"✅"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:o("todos.title")}),t.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:o("todos.subtitle")})]})]}),t.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:t.jsx("div",{className:"flex space-x-2 sm:space-x-3 overflow-x-auto",children:[{key:"all",label:o("todos.all"),count:n.length},{key:"pending",label:o("todos.pending"),count:F},{key:"completed",label:o("todos.completed"),count:E}].map(e=>t.jsxs("button",{onClick:()=>y(e.key),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 whitespace-nowrap text-sm sm:text-base ${c===e.key?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[e.label," (",e.count,")"]},e.key))})})]})}),w.length===0?t.jsxs("div",{className:"card text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:o(c==="completed"?"todos.empty_completed":c==="pending"?"todos.empty_pending":"todos.empty_all")}),t.jsx("p",{className:"text-muted text-base",children:o("todos.empty_subtitle")})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:P.map(e=>{const r=B(e.content),i=T(e.id),v=r&&!i?z(e.content):e.content,f=()=>{const a=U({onSwipeLeft:()=>b(e.id,!0),onSwipeRight:()=>{p(e.id),u(!0)}},{threshold:100,preventScrollOnSwipe:!0}),R=X(()=>{p(e.id),u(!0)},{threshold:500});return t.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${e.isCompleted?"opacity-60":""} ${a.isDragging?a.swipeDirection==="left"?"bg-red-50 border-red-200":a.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""}`,style:{transform:a.isDragging?`translateX(${Math.min(Math.max(a.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},...a.swipeHandlers,...R.handlers,children:[t.jsx("button",{onClick:()=>b(e.id),className:"text-muted hover:text-red-600 absolute top-4 right-4 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 z-10","aria-label":"Delete todo",children:"🗑️"}),t.jsxs("div",{className:"flex flex-col space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("button",{onClick:()=>{p(e.id),u(!0)},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"✅ 할 일"}),t.jsx("div",{className:"badge",children:j(e.createdAt)})]}),t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("button",{onClick:()=>k(e.id),className:`flex-shrink-0 w-7 h-7 rounded-2xl border-2 flex items-center justify-center transition-all mt-1 ${e.isCompleted?"shadow-md":"hover:bg-opacity-10"}`,style:e.isCompleted?{backgroundColor:"#8ABF92",borderColor:"#8ABF92",color:"#038C3E"}:{borderColor:"#8ABF92",backgroundColor:"transparent",color:"#8ABF92"},children:e.isCompleted&&t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-base font-semibold leading-relaxed mb-3 pr-8 whitespace-pre-line ${e.isCompleted?"line-through text-muted":"text-primary"}`,children:v}),r&&t.jsx("button",{onClick:()=>N(e.id),className:"mb-3 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:i?"접기":"...더보기"}),t.jsx("div",{className:"flex flex-col space-y-2 mt-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[!e.isCompleted&&t.jsxs(t.Fragment,{children:[t.jsx("input",{ref:d=>{d&&(d._todoId=e.id)},type:"date",value:e.dueDate?e.dueDate.toISOString().split("T")[0]:"",onChange:d=>S(e.id,d),className:"sr-only absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),t.jsxs("button",{type:"button",className:`relative font-bold px-3 py-1 rounded-xl text-xs transition-colors duration-200 cursor-pointer ${e.dueDate?"btn-primary text-white":"text-date hover:bg-green-50 border border-gray-200"}`,onClick:d=>{d.preventDefault();const s=d.currentTarget.parentElement?.querySelector('input[type="date"]');if(s)try{"showPicker"in s&&typeof s.showPicker=="function"?s.showPicker():(s.style.position="fixed",s.style.top="50%",s.style.left="50%",s.style.transform="translate(-50%, -50%)",s.style.zIndex="9999",s.style.opacity="0.01",s.style.width="100px",s.style.height="50px",s.focus(),s.click(),setTimeout(()=>{s.className="sr-only absolute inset-0 w-full h-full opacity-0 cursor-pointer",s.style.cssText="",s.className="sr-only absolute inset-0 w-full h-full opacity-0 cursor-pointer"},100))}catch{s.style.position="static",s.style.opacity="1",s.style.width="auto",s.style.height="auto",s.focus()}},children:["📅 ",e.dueDate?`${o("todos.due")}: ${j(e.dueDate,{year:"numeric",month:"short",day:"numeric"})}`:"마감일 지정"]})]}),t.jsx("button",{onClick:()=>$(e.id,e.priority),className:`btn px-3 py-1 text-xs ${A(e.priority)}`,"aria-label":"Priority change",children:L(e.priority)})]})})]})]})]}),a.isDragging&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${a.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),t.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${a.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},e.id)};return t.jsx(f,{},e.id)})}),t.jsx(G,{isOpen:C,currentCategory:"todo",onCategorySelect:I,onClose:()=>{u(!1),p("")}})]})};export{W as TodosPage};
