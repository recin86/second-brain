import{u as W,a as Y,r as o,d as c,j as t}from"./index-CkiIdOd7.js";import{u as Z,i as ee,g as te,C as se,b as E}from"./CategoryChangeModal-mVw1092v.js";import{E as re,u as ie,a as ne,s as oe}from"./smartEdit-BzseLFlM.js";function ae(i,u){let n;return function(...y){const d=this,f=()=>{n=null,i.apply(d,y)};n&&clearTimeout(n),n=setTimeout(f,u)}}const me=()=>{const{t:i}=W(),{showUndo:u}=Y(),[n,y]=o.useState([]),[d,f]=o.useState("all"),[$,p]=o.useState(!1),[x,h]=o.useState(""),[P,w]=o.useState(!1),[v,j]=o.useState(null),[m,g]=o.useState(!1),[a,b]=o.useState(new Set),{toggleCardExpansion:F,isExpanded:M}=Z();o.useEffect(()=>{const e=c.subscribeToTodos(y);return()=>e()},[]);const I=e=>{const s=n.find(r=>r.id===e);s&&c.updateTodo(e,{isCompleted:!s.isCompleted})},O=o.useRef(ae((e,s)=>{c.updateTodo(e,s)},500)),z=(e,s)=>{const r=s.target.value?new Date(s.target.value):void 0;O.current(e,{dueDate:r})},A=e=>{const s=document.getElementById(`date-input-${e}`);if(s&&(s.focus(),s.click(),typeof s.showPicker=="function"))try{s.showPicker()}catch{}},B=(e,s)=>{const r=["low","medium","high"],C=(r.indexOf(s)+1)%r.length;c.updateTodo(e,{priority:r[C]})},L=e=>{j(e),w(!0)},R=async e=>{if(v)try{const s=await oe(v,"todo",e);w(!1),j(null),s.converted&&u(`할 일이 ${_(s.newType)}로 변환되었습니다`,()=>{})}catch(s){console.error("Failed to update todo:",s)}},_=e=>{switch(e){case"thought":return"생각";case"radiology":return"영상의학";case"investment":return"투자";default:return e}},S=async(e,s=!1)=>{if(!(!s&&!window.confirm(i("todos.delete_confirm"))))try{const r=await c.softDeleteTodo(e);u("할 일이 삭제되었습니다",r)}catch(r){console.error("Failed to delete todo:",r)}},G=async e=>{if(x)try{switch(e){case"thought":await c.convertToThought(x,"todo");break;case"investment":await c.convertToInvestment(x,"todo");break;case"radiology":await c.convertToRadiology(x,"todo");break}p(!1),h("")}catch(s){console.error("Failed to convert category:",s)}},k=e=>{m&&b(s=>{const r=new Set(s);return r.has(e)?(r.delete(e),r.size===0&&g(!1)):r.add(e),r})},U=async()=>{if(a.size!==0&&window.confirm(`선택한 ${a.size}개의 항목을 삭제하시겠습니까?`))try{const e=Array.from(a).map(r=>c.softDeleteTodo(r)),s=await Promise.all(e);u(`${a.size}개의 할 일이 삭제되었습니다`,()=>{s.forEach(r=>r())}),b(new Set),g(!1)}catch(e){console.error("Failed to delete selected todos:",e)}},X=()=>{g(!1),b(new Set)},T=n.filter(e=>d==="pending"?!e.isCompleted:d==="completed"?e.isCompleted:!0),H=[...T].sort((e,s)=>e.isCompleted===s.isCompleted?s.createdAt.getTime()-e.createdAt.getTime():e.isCompleted?1:-1),q=n.filter(e=>!e.isCompleted).length,J=n.filter(e=>e.isCompleted).length,K=e=>{switch(e){case"high":return"bg-red-600 hover:bg-red-700 text-white border-red-700";case"medium":return"btn-secondary";case"low":return"btn-accent";default:return"text-date"}},Q=e=>{switch(e){case"high":return i("todos.priority.high");case"medium":return i("todos.priority.medium");case"low":return i("todos.priority.low");default:return i("todos.priority.medium")}};return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[t.jsx("div",{className:"mb-6 sm:mb-8",children:t.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:t.jsx("span",{className:"text-xl sm:text-2xl",children:"✅"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:i("todos.title")}),t.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:i("todos.subtitle")})]})]}),m&&t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("span",{className:"text-white text-sm sm:text-base",children:[a.size,"개 선택됨"]}),t.jsx("button",{onClick:X,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm transition-colors",children:"취소"}),t.jsxs("button",{onClick:U,disabled:a.size===0,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-500 rounded-lg text-sm transition-colors",children:["삭제 (",a.size,")"]})]})]}),t.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:t.jsx("div",{className:"flex space-x-2 sm:space-x-3 overflow-x-auto",children:[{key:"all",label:i("todos.all"),count:n.length},{key:"pending",label:i("todos.pending"),count:q},{key:"completed",label:i("todos.completed"),count:J}].map(e=>t.jsxs("button",{onClick:()=>f(e.key),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 whitespace-nowrap text-sm sm:text-base ${d===e.key?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[e.label," (",e.count,")"]},e.key))})})]})}),T.length===0?t.jsxs("div",{className:"card text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:i(d==="completed"?"todos.empty_completed":d==="pending"?"todos.empty_pending":"todos.empty_all")}),t.jsx("p",{className:"text-muted text-base",children:i("todos.empty_subtitle")})]}):t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(e=>{const s=ee(e.content),r=M(e.id),D=s&&!r?te(e.content):e.content,C=()=>{const l=ie({onSwipeLeft:()=>S(e.id,!0),onSwipeRight:()=>{h(e.id),p(!0)}},{threshold:100,preventScrollOnSwipe:!0}),V=ne(()=>{m||(g(!0),b(new Set([e.id])))},{threshold:500});return t.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${e.isCompleted?"opacity-60":""} ${l.isDragging?l.swipeDirection==="left"?"bg-red-50 border-red-200":l.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""} ${m&&a.has(e.id)?"ring-2 ring-blue-500 bg-blue-50":""}`,style:{transform:l.isDragging?`translateX(${Math.min(Math.max(l.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},onClick:()=>k(e.id),...m?{}:l.swipeHandlers,...V.handlers,children:[t.jsxs("div",{className:"flex flex-col space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[m&&t.jsx("input",{type:"checkbox",checked:a.has(e.id),onChange:()=>k(e.id),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("button",{onClick:N=>{N.stopPropagation(),m||(h(e.id),p(!0))},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"✅ 할 일"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>L(e),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit todo",title:"수정",children:"✏️"}),t.jsx("button",{onClick:()=>S(e.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete todo",children:"🗑️"})]})]}),t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("button",{onClick:()=>I(e.id),className:`flex-shrink-0 w-7 h-7 rounded-2xl border-2 flex items-center justify-center transition-all mt-1 ${e.isCompleted?"shadow-md":"hover:bg-opacity-10"}`,style:e.isCompleted?{backgroundColor:"#8ABF92",borderColor:"#8ABF92",color:"#038C3E"}:{borderColor:"#8ABF92",backgroundColor:"transparent",color:"#8ABF92"},children:e.isCompleted&&t.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:`text-base font-semibold leading-relaxed mb-3 pr-8 whitespace-pre-line ${e.isCompleted?"line-through text-muted":"text-primary"}`,children:D}),s&&t.jsx("button",{onClick:()=>F(e.id),className:"mb-3 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:r?"접기":"...더보기"}),t.jsxs("div",{className:"flex flex-col space-y-2 mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[!e.isCompleted&&t.jsxs("div",{className:"relative",children:[t.jsx("input",{id:`date-input-${e.id}`,type:"date",value:e.dueDate?e.dueDate.toISOString().split("T")[0]:"",onChange:N=>z(e.id,N),className:"sr-only"}),t.jsxs("button",{onClick:()=>A(e.id),className:`font-bold px-3 py-1 rounded-xl text-xs transition-colors duration-200 border cursor-pointer hover:scale-105 transform ${e.dueDate?"btn-primary text-white bg-blue-600 border-blue-600":"text-gray-600 hover:bg-green-50 border-gray-200 bg-white hover:border-green-300"}`,children:["📅 ",e.dueDate?`${i("todos.due")}: ${E(e.dueDate,{year:"numeric",month:"short",day:"numeric"})}`:"마감일 지정"]})]}),t.jsx("button",{onClick:()=>B(e.id,e.priority),className:`btn px-3 py-1 text-xs ${K(e.priority)}`,"aria-label":"Priority change",children:Q(e.priority)})]}),t.jsx("div",{className:"flex justify-end mt-3",children:t.jsx("div",{className:"text-xs text-gray-500",children:E(e.createdAt)})})]})]})]})]}),l.isDragging&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${l.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),t.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${l.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},e.id)};return t.jsx(C,{},e.id)})}),t.jsx(se,{isOpen:$,currentCategory:"todo",onCategorySelect:G,onClose:()=>{p(!1),h("")}}),t.jsx(re,{isOpen:P,title:"할 일 수정",initialContent:v?.content||"",onSave:R,onClose:()=>{w(!1),j(null)}})]})};export{me as TodosPage};
