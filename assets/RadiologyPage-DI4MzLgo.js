import{u as M,a as R,r as l,d as x,j as t}from"./index-D4Z3RT2C.js";import{u as $,i as F,g as I,C as L,b as O}from"./CategoryChangeModal-DNN8Ni7i.js";import{u as P,a as _}from"./useLongPress-l4gSpHse.js";const H=()=>{const{t:i}=M(),{showUndo:y}=R(),[o,b]=l.useState([]),[n,g]=l.useState("all"),[f,d]=l.useState(!1),[p,c]=l.useState(""),{toggleCardExpansion:v,isExpanded:j}=$();l.useEffect(()=>{const e=x.subscribeToRadiologyNotes(b);return()=>e()},[]);const w=l.useMemo(()=>{const e=new Set;return o.forEach(s=>{s.tags.filter(a=>a!=="#rad").forEach(a=>e.add(a))}),Array.from(e).sort()},[o]),h=l.useMemo(()=>n==="all"?o:o.filter(e=>e.tags.includes(n)),[o,n]),N=e=>o.filter(s=>s.tags.includes(e)).length,u=async(e,s=!1)=>{if(!(!s&&!window.confirm(i("radiology.delete_confirm"))))try{const a=await x.softDeleteRadiologyNote(e);y("영상의학 노트가 삭제되었습니다",a)}catch(a){console.error("Failed to delete radiology note:",a)}},C=async e=>{if(p)try{switch(e){case"thought":await x.convertToThought(p,"radiology");break;case"todo":await x.convertToTodo(p,"radiology");break;case"investment":await x.convertToInvestment(p,"radiology");break}d(!1),c("")}catch(s){console.error("Failed to convert category:",s)}},S=e=>e.startsWith("#")?e.slice(1):e;return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[t.jsx("div",{className:"mb-6 sm:mb-8",children:t.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[t.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:t.jsx("span",{className:"text-xl sm:text-2xl",children:"🔬"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:i("radiology.title")}),t.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:i("radiology.subtitle")})]})]}),t.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:t.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:[t.jsxs("button",{onClick:()=>g("all"),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${n==="all"?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[i("radiology.all")," (",o.length,")"]}),w.map(e=>t.jsxs("button",{onClick:()=>g(e),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${n===e?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[S(e)," (",N(e),")"]},e))]})})]})}),h.length===0?t.jsxs("div",{className:"card text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:i(n==="all"?"radiology.empty_all":"radiology.empty_tag")}),t.jsx("p",{className:"text-muted text-base",children:i("radiology.empty_subtitle")})]}):t.jsx("div",{className:"space-y-6",children:h.map(e=>{const s=F(e.content),a=j(e.id),T=s&&!a?I(e.content):e.content,D=()=>{const r=P({onSwipeLeft:()=>u(e.id,!0),onSwipeRight:()=>{c(e.id),d(!0)}},{threshold:100,preventScrollOnSwipe:!0}),k=_(()=>{c(e.id),d(!0)},{threshold:500});return t.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${r.isDragging?r.swipeDirection==="left"?"bg-red-50 border-red-200":r.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""}`,style:{transform:r.isDragging?`translateX(${Math.min(Math.max(r.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},...r.swipeHandlers,...k.handlers,children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>{c(e.id),d(!0)},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"🔬 영상의학"}),t.jsx("div",{className:"badge",children:O(e.createdAt)})]}),t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex-1 pr-8",children:[t.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:T}),s&&t.jsx("button",{onClick:()=>v(e.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:a?"접기":"...더보기"})]}),t.jsx("button",{onClick:()=>u(e.id),className:"absolute top-4 right-4 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete note",children:"🗑️"})]}),e.tags.filter(m=>m!=="#rad").length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.filter(m=>m!=="#rad").map((m,E)=>t.jsx("span",{className:"badge",children:m},E))})]}),r.isDragging&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${r.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),t.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${r.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},e.id)};return t.jsx(D,{},e.id)})}),t.jsx(L,{isOpen:f,currentCategory:"radiology",onCategorySelect:C,onClose:()=>{d(!1),c("")}})]})};export{H as RadiologyPage};
