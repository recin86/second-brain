import{R as L,u as k,r,j as t,d as l,A as _,U as P,T as b}from"./index-De6PUwLb.js";import{u as q,i as F,g as U,f as W,C as B}from"./CategoryChangeModal-DU7tmDqJ.js";const S=s=>{const e=/#\w+/g,o=s.match(e);return o?o.map(a=>a.toLowerCase()):[]},G=s=>S(s).some(o=>o==="#rad"),K=s=>{const e=S(s),o=e.findIndex(a=>a==="#rad");return o===-1?[]:e.slice(o+1)},$=s=>s.replace(/#\w+/g,"").trim().replace(/\s+/g," "),z=s=>{if(!G(s))return null;const e=K(s);return{type:"radiology",content:$(s),tags:S(s),subtags:e,icon:"🏥",description:e.length>0?`Radiology note with tags: ${e.join(", ")}`:"Radiology note"}};function I(s){const e=s.trim();if(e.endsWith("'")||e.endsWith(";;"))return{type:"investment",content:e.endsWith(";;")?e.slice(0,-2).trim():e.slice(0,-1).trim(),icon:"💰",description:"투자로 저장",statusMessage:"내 투자에 저장됩니다"};const o=z(e);if(o)return{...o,statusMessage:"영상의학에 저장됩니다"};if(e.endsWith(";")){let a=e.slice(0,-1).trim(),u;const m=/\s@(.+)$/,x=a.match(m);if(x&&x[1]){const c=x[1],y=new Date(c);isNaN(y.getTime())||(u=y,a=a.replace(m,"").trim())}return{type:"todo",content:a,icon:"✅",description:u?`할 일로 저장 (마감일: ${u.toLocaleDateString()})`:"할 일로 저장 + 캘린더 등록",dueDate:u,statusMessage:"내 할 일에 저장됩니다"}}return{type:"thought",content:e,icon:"💭",description:"내 생각으로 저장",statusMessage:"내 생각에 저장됩니다"}}const H=L.memo(()=>{const{t:s}=k(),[e,o]=r.useState(""),[a,u]=r.useState(null),[m,x]=r.useState(!1),c=r.useRef(null);r.useEffect(()=>{c.current&&c.current.focus()},[]),r.useEffect(()=>{e.trim()?u(I(e)):u(null)},[e]);const y=async d=>{if(d){if(d.key==="Enter"&&d.shiftKey)return;if(d.key==="Enter"&&!d.shiftKey)d.preventDefault();else if(d.key!=="Enter")return}if(!(!e.trim()||m)){x(!0);try{const i=I(e);i.type==="todo"?await l.addTodo(i.content,i.dueDate):i.type==="radiology"?await l.addRadiologyNote(i.content,i.tags||[]):i.type==="investment"?await l.addInvestment(i.content):await l.addThought(i.content),o(""),u(null),requestAnimationFrame(()=>{c.current&&(c.current.focus(),c.current.setSelectionRange(0,0))})}catch(i){console.error("Failed to save entry:",i)}finally{x(!1)}}},N=async()=>{await y(),requestAnimationFrame(()=>{c.current&&c.current.focus()})},w=r.useCallback(d=>{o(d.target.value)},[]);return t.jsx("div",{className:"px-0 sm:px-0 mb-6 sm:mb-8",children:t.jsx("div",{className:"bg-primary rounded-xl sm:rounded-3xl p-3 sm:p-8 shadow-lg border border-transparent mx-0 sm:mx-0",children:t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("div",{children:t.jsx("h2",{className:"text-2xl sm:text-3xl font-bold mb-4 sm:mb-6 tracking-tight text-white",children:s("quick.title")})}),t.jsxs("div",{className:"relative",children:[t.jsx("textarea",{ref:c,value:e,onChange:w,onKeyDown:y,placeholder:s("quick.placeholder"),className:"w-full min-h-[100px] sm:min-h-[120px] p-4 text-base sm:text-xl border border-transparent bg-gray-100 text-gray-800 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary resize-none placeholder-gray-500 placeholder:text-sm font-normal leading-relaxed",disabled:m,rows:3}),t.jsx("button",{onClick:N,disabled:!e.trim()||m,className:"absolute bottom-2 right-2 sm:bottom-3 sm:right-3 w-10 h-10 sm:w-12 sm:h-12 text-white rounded-lg transition-all duration-200 flex items-center justify-center shadow-md hover:shadow-lg submit-button-green",children:m?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx("svg",{className:"w-5 h-5 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),a&&t.jsxs("div",{className:"text-left text-sm sm:text-base text-white/80 bg-white/10 px-3 py-2 rounded-lg",children:[t.jsx("span",{className:"text-lg mr-2",children:a.icon}),a.statusMessage]})]})})})}),V=()=>{const{t:s}=k(),{toggleCardExpansion:e,isExpanded:o}=q(),[a,u]=r.useState([]),[m,x]=r.useState([]),[c,y]=r.useState([]),[N,w]=r.useState([]),[d,i]=r.useState(!1),[T,j]=r.useState(""),[g,C]=r.useState("thought");r.useEffect(()=>{const n=l.subscribeToThoughts(u),p=l.subscribeToTodos(x),f=l.subscribeToRadiologyNotes(y),v=l.subscribeToInvestments(w);return()=>{n(),p(),f(),v()}},[]);const E=r.useMemo(()=>{const n=a.map(h=>({...h,entryType:"thought"})),p=m.map(h=>({...h,entryType:"todo"})),f=c.map(h=>({...h,entryType:"radiology"})),v=N.map(h=>({...h,entryType:"investment"}));return[...n,...p,...f,...v].sort((h,M)=>new Date(M.createdAt).getTime()-new Date(h.createdAt).getTime()).slice(0,_.RECENT_ENTRIES_LIMIT)},[a,m,c,N]),R=n=>{switch(n.entryType){case"todo":return n.isCompleted?b.TODO_COMPLETED:b.TODO_PENDING;case"thought":return b.THOUGHT;case"radiology":return b.RADIOLOGY;case"investment":return b.INVESTMENT;default:return b.DEFAULT}},D=n=>{switch(n.entryType){case"todo":return s("type.todo");case"thought":return s("type.thought");case"radiology":return s("type.radiology");case"investment":return s("type.investment");default:return""}},O=async n=>{if(T)try{switch(n){case"thought":g!=="thought"&&await l.convertToThought(T,g);break;case"todo":g!=="todo"&&await l.convertToTodo(T,g);break;case"investment":g!=="investment"&&await l.convertToInvestment(T,g);break;case"radiology":g!=="radiology"&&await l.convertToRadiology(T,g);break}i(!1),j(""),C("thought")}catch(p){console.error("Failed to convert category:",p)}},A=n=>{j(n.id),C(n.entryType),i(!0)};return t.jsxs("div",{className:"max-w-7xl mx-auto px-0 sm:px-8 py-4 sm:py-8",children:[t.jsx(H,{}),E.length>0&&t.jsxs("div",{className:"px-4 sm:px-0",children:[t.jsxs("div",{className:"mb-6 sm:mb-8",children:[t.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-2 tracking-tight",children:s("quick.recent")}),t.jsx("p",{className:"text-gray-500 text-base sm:text-lg font-medium",children:s("quick.recent_subtitle")})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:E.map(n=>{const p=F(n.content),f=o(n.id),v=p&&!f?U(n.content):n.content;return t.jsx("div",{className:"card card-hover",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("button",{onClick:()=>A(n),className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:[R(n)," ",D(n)]}),t.jsx("span",{className:"badge",children:W(n.createdAt)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-base leading-relaxed text-primary font-medium whitespace-pre-line",children:v}),p&&t.jsx("button",{onClick:()=>e(n.id),className:P.EXPAND_BUTTON_CLASSES,children:f?"접기":"...더보기"})]})]})},n.id)})})]}),t.jsx(B,{isOpen:d,currentCategory:g,onCategorySelect:O,onClose:()=>{i(!1),j(""),C("thought")}})]})};export{V as QuickPage};
