import{u as P,a as _,r as i,d as x,j as t}from"./index-CpoK_CYL.js";import{u as A,i as G,g as X,C as H,b as U}from"./CategoryChangeModal-DcJAKWMq.js";import{E as W,u as q,a as z,s as B}from"./smartEdit-BPExGv78.js";const V=()=>{const{t:o}=P(),{showUndo:y}=_(),[l,j]=i.useState([]),[n,b]=i.useState("all"),[w,c]=i.useState(!1),[u,d]=i.useState(""),[N,p]=i.useState(!1),[g,h]=i.useState(null),{toggleCardExpansion:C,isExpanded:S}=A();i.useEffect(()=>{const e=x.subscribeToRadiologyNotes(j);return()=>e()},[]);const E=i.useMemo(()=>{const e=new Set;return l.forEach(s=>{s.tags.filter(a=>a!=="#rad").forEach(a=>e.add(a))}),Array.from(e).sort()},[l]),f=i.useMemo(()=>n==="all"?l:l.filter(e=>e.tags.includes(n)),[l,n]),T=e=>l.filter(s=>s.tags.includes(e)).length,D=e=>{h(e),p(!0)},k=async e=>{if(g)try{const s=await B(g,"radiology",e);p(!1),h(null),s.converted&&y(`영상의학 노트가 ${M(s.newType)}로 변환되었습니다`,()=>{})}catch(s){console.error("Failed to update radiology note:",s)}},M=e=>{switch(e){case"thought":return"생각";case"todo":return"할 일";case"investment":return"투자";default:return e}},v=async(e,s=!1)=>{if(!(!s&&!window.confirm(o("radiology.delete_confirm"))))try{const a=await x.softDeleteRadiologyNote(e);y("영상의학 노트가 삭제되었습니다",a)}catch(a){console.error("Failed to delete radiology note:",a)}},O=async e=>{if(u)try{switch(e){case"thought":await x.convertToThought(u,"radiology");break;case"todo":await x.convertToTodo(u,"radiology");break;case"investment":await x.convertToInvestment(u,"radiology");break}c(!1),d("")}catch(s){console.error("Failed to convert category:",s)}},$=e=>e.startsWith("#")?e.slice(1):e;return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[t.jsx("div",{className:"mb-6 sm:mb-8",children:t.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[t.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:t.jsx("span",{className:"text-xl sm:text-2xl",children:"🔬"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:o("radiology.title")}),t.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:o("radiology.subtitle")})]})]}),t.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:t.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:[t.jsxs("button",{onClick:()=>b("all"),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${n==="all"?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[o("radiology.all")," (",l.length,")"]}),E.map(e=>t.jsxs("button",{onClick:()=>b(e),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${n===e?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[$(e)," (",T(e),")"]},e))]})})]})}),f.length===0?t.jsxs("div",{className:"card text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:o(n==="all"?"radiology.empty_all":"radiology.empty_tag")}),t.jsx("p",{className:"text-muted text-base",children:o("radiology.empty_subtitle")})]}):t.jsx("div",{className:"space-y-6",children:f.map(e=>{const s=G(e.content),a=S(e.id),F=s&&!a?X(e.content):e.content,I=()=>{const r=q({onSwipeLeft:()=>v(e.id,!0),onSwipeRight:()=>{d(e.id),c(!0)}},{threshold:100,preventScrollOnSwipe:!0}),R=z(()=>{d(e.id),c(!0)},{threshold:500});return t.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${r.isDragging?r.swipeDirection==="left"?"bg-red-50 border-red-200":r.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""}`,style:{transform:r.isDragging?`translateX(${Math.min(Math.max(r.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},...r.swipeHandlers,...R.handlers,children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("button",{onClick:()=>{d(e.id),c(!0)},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"🔬 영상의학"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>D(e),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit note",title:"수정",children:"✏️"}),t.jsx("button",{onClick:()=>v(e.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete note",children:"🗑️"})]})]}),t.jsx("div",{className:"flex items-start justify-between mb-4",children:t.jsxs("div",{className:"flex-1 pr-8",children:[t.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:F}),s&&t.jsx("button",{onClick:()=>C(e.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:a?"접기":"...더보기"})]})}),e.tags.filter(m=>m!=="#rad").length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.filter(m=>m!=="#rad").map((m,L)=>t.jsx("span",{className:"badge",children:m},L))}),t.jsx("div",{className:"flex justify-end mt-4",children:t.jsx("div",{className:"text-xs text-gray-500",children:U(e.createdAt)})})]}),r.isDragging&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${r.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),t.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${r.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},e.id)};return t.jsx(I,{},e.id)})}),t.jsx(H,{isOpen:w,currentCategory:"radiology",onCategorySelect:O,onClose:()=>{c(!1),d("")}}),t.jsx(W,{isOpen:N,title:"영상의학 노트 수정",initialContent:g?.content||"",onSave:k,onClose:()=>{p(!1),h(null)}})]})};export{V as RadiologyPage};
