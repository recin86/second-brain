import{u as H,a as U,r,d as u,j as t}from"./index-CkiIdOd7.js";import{u as W,i as q,g as J,C as K,b as Q}from"./CategoryChangeModal-mVw1092v.js";import{E as V,u as Y,a as Z,s as ee}from"./smartEdit-BzseLFlM.js";const re=()=>{const{t:l}=H(),{showUndo:f}=U(),[n,E]=r.useState([]),[m,v]=r.useState("all"),[k,h]=r.useState(!1),[g,p]=r.useState(""),[T,w]=r.useState(!1),[x,j]=r.useState(null),[c,y]=r.useState(!1),[i,b]=r.useState(new Set),{toggleCardExpansion:D,isExpanded:M}=W();r.useEffect(()=>{const e=u.subscribeToRadiologyNotes(E);return()=>e()},[]);const $=r.useMemo(()=>{const e=new Set;return n.forEach(a=>{a.tags.filter(s=>s!=="#rad").forEach(s=>e.add(s))}),Array.from(e).sort()},[n]),N=r.useMemo(()=>m==="all"?n:n.filter(e=>e.tags.includes(m)),[n,m]),F=e=>n.filter(a=>a.tags.includes(e)).length,z=e=>{j(e),w(!0)},O=async e=>{if(x)try{const a=await ee(x,"radiology",e);w(!1),j(null),a.converted&&f(`영상의학 노트가 ${P(a.newType)}로 변환되었습니다`,()=>{})}catch(a){console.error("Failed to update radiology note:",a)}},P=e=>{switch(e){case"thought":return"생각";case"todo":return"할 일";case"investment":return"투자";default:return e}},S=async(e,a=!1)=>{if(!(!a&&!window.confirm(l("radiology.delete_confirm"))))try{const s=await u.softDeleteRadiologyNote(e);f("영상의학 노트가 삭제되었습니다",s)}catch(s){console.error("Failed to delete radiology note:",s)}},R=async e=>{if(g)try{switch(e){case"thought":await u.convertToThought(g,"radiology");break;case"todo":await u.convertToTodo(g,"radiology");break;case"investment":await u.convertToInvestment(g,"radiology");break}h(!1),p("")}catch(a){console.error("Failed to convert category:",a)}},C=e=>{c&&b(a=>{const s=new Set(a);return s.has(e)?(s.delete(e),s.size===0&&y(!1)):s.add(e),s})},I=async()=>{if(i.size!==0&&window.confirm(`선택한 ${i.size}개의 항목을 삭제하시겠습니까?`))try{const e=Array.from(i).map(s=>u.softDeleteRadiologyNote(s)),a=await Promise.all(e);f(`${i.size}개의 영상의학 노트가 삭제되었습니다`,()=>{a.forEach(s=>s())}),b(new Set),y(!1)}catch(e){console.error("Failed to delete selected notes:",e)}},L=()=>{y(!1),b(new Set)},_=e=>e.startsWith("#")?e.slice(1):e;return t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-8 py-6 sm:py-12",children:[t.jsx("div",{className:"mb-6 sm:mb-8",children:t.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:t.jsx("span",{className:"text-xl sm:text-2xl",children:"🔬"})}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:l("radiology.title")}),t.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:l("radiology.subtitle")})]})]}),c&&t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsxs("span",{className:"text-white text-sm sm:text-base",children:[i.size,"개 선택됨"]}),t.jsx("button",{onClick:L,className:"px-3 py-1 bg-white/20 hover:bg-white/30 rounded-lg text-sm transition-colors",children:"취소"}),t.jsxs("button",{onClick:I,disabled:i.size===0,className:"px-3 py-1 bg-red-500 hover:bg-red-600 disabled:bg-gray-500 rounded-lg text-sm transition-colors",children:["삭제 (",i.size,")"]})]})]}),t.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md",children:t.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:[t.jsxs("button",{onClick:()=>v("all"),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${m==="all"?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[l("radiology.all")," (",n.length,")"]}),$.map(e=>t.jsxs("button",{onClick:()=>v(e),className:`px-3 py-2 sm:px-4 sm:py-2 rounded-lg font-semibold transition-all duration-200 text-sm sm:text-base ${m===e?"bg-primary text-white shadow-md":"text-primary hover:text-primary/80 bg-transparent hover:bg-primary/10"}`,children:[_(e)," (",F(e),")"]},e))]})})]})}),N.length===0?t.jsxs("div",{className:"card text-center",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:l(m==="all"?"radiology.empty_all":"radiology.empty_tag")}),t.jsx("p",{className:"text-muted text-base",children:l("radiology.empty_subtitle")})]}):t.jsx("div",{className:"space-y-6",children:N.map(e=>{const a=q(e.content),s=M(e.id),A=a&&!s?J(e.content):e.content,G=()=>{const o=Y({onSwipeLeft:()=>S(e.id,!0),onSwipeRight:()=>{p(e.id),h(!0)}},{threshold:100,preventScrollOnSwipe:!0}),X=Z(()=>{c||(y(!0),b(new Set([e.id])))},{threshold:500});return t.jsxs("div",{className:`card card-hover relative group transform transition-transform duration-200 ${o.isDragging?o.swipeDirection==="left"?"bg-red-50 border-red-200":o.swipeDirection==="right"?"bg-blue-50 border-blue-200":"":""} ${c&&i.has(e.id)?"ring-2 ring-blue-500 bg-blue-50":""}`,style:{transform:o.isDragging?`translateX(${Math.min(Math.max(o.getSwipeDistance(),-150),150)}px)`:"translateX(0)"},onClick:()=>C(e.id),...c?{}:o.swipeHandlers,...X.handlers,children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[c&&t.jsx("input",{type:"checkbox",checked:i.has(e.id),onChange:()=>C(e.id),className:"w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),t.jsx("button",{onClick:d=>{d.stopPropagation(),c||(p(e.id),h(!0))},className:"badge hover:bg-blue-100 hover:border-blue-300 hover:text-blue-700 transition-colors cursor-pointer",title:"카테고리 변경",children:"🔬 영상의학"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:()=>z(e),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-blue-600 p-1","aria-label":"Edit note",title:"수정",children:"✏️"}),t.jsx("button",{onClick:()=>S(e.id),className:"opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200 text-muted hover:text-red-600 p-1","aria-label":"Delete note",children:"🗑️"})]})]}),t.jsx("div",{className:"flex items-start justify-between mb-4",children:t.jsxs("div",{className:"flex-1 pr-8",children:[t.jsx("p",{className:"text-base leading-relaxed font-medium text-primary whitespace-pre-line",children:A}),a&&t.jsx("button",{onClick:()=>D(e.id),className:"mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors",children:s?"접기":"...더보기"})]})}),e.tags.filter(d=>d!=="#rad").length>0&&t.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.filter(d=>d!=="#rad").map((d,B)=>t.jsx("span",{className:"badge",children:d},B))}),t.jsx("div",{className:"flex justify-end mt-4",children:t.jsx("div",{className:"text-xs text-gray-500",children:Q(e.createdAt)})})]}),o.isDragging&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${o.swipeDirection==="right"?"opacity-100":"opacity-30"}`,children:"🔄"}),t.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl transition-opacity ${o.swipeDirection==="left"?"opacity-100":"opacity-30"}`,children:"🗑️"})]})]},e.id)};return t.jsx(G,{},e.id)})}),t.jsx(K,{isOpen:k,currentCategory:"radiology",onCategorySelect:R,onClose:()=>{h(!1),p("")}}),t.jsx(V,{isOpen:T,title:"영상의학 노트 수정",initialContent:x?x.content+(x.tags.length>0?" "+x.tags.join(" "):""):"",onSave:O,onClose:()=>{w(!1),j(null)}})]})};export{re as RadiologyPage};
