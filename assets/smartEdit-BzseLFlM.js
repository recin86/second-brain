import{r as a,u as N,j as h,d as p}from"./index-CkiIdOd7.js";import{c as D}from"./CategoryChangeModal-mVw1092v.js";const R=(e,c={})=>{const{threshold:s=100,preventScrollOnSwipe:l=!1}=c,[o,m]=a.useState(!1),[t,b]=a.useState(null),[r,f]=a.useState(null),[i,d]=a.useState(!1),w=a.useCallback(u=>{if(u.touches.length!==1)return;const g=u.touches[0],n={x:g.clientX,y:g.clientY};m(!0),b(n),f(n),d(!1),e.onSwipeStart?.()},[e]),S=a.useCallback(u=>{if(!o||!t||u.touches.length!==1)return;const g=u.touches[0],n={x:g.clientX,y:g.clientY},x=Math.abs(n.x-t.x),k=Math.abs(n.y-t.y);x>k&&x>10&&(d(!0),l&&u.preventDefault()),f(n)},[o,t,l]),y=a.useCallback(()=>{if(!o||!t||!r){m(!1),b(null),f(null),d(!1);return}const u=r.x-t.x,g=Math.abs(r.y-t.y);Math.abs(u)>s&&Math.abs(u)>g&&(u>0?e.onSwipeRight?.():e.onSwipeLeft?.()),m(!1),b(null),f(null),d(!1),e.onSwipeEnd?.()},[o,t,r,s,e]),v=a.useCallback(()=>!t||!r?0:r.x-t.x,[t,r]),C=a.useCallback(()=>{const u=Math.abs(v());return Math.min(u/s,1)},[v,s]);return{swipeHandlers:{onTouchStart:w,onTouchMove:S,onTouchEnd:y,onTouchCancel:y},isDragging:i,isPressed:o,getSwipeDistance:v,getSwipeProgress:C,swipeDirection:t&&r?r.x>t.x?"right":"left":null}},I=(e,c={})=>{const{threshold:s=500,onStart:l,onFinish:o,onCancel:m}=c,[t,b]=a.useState(!1),r=a.useRef(null),f=a.useRef(null),i=a.useCallback((n,x)=>{b(!0),f.current={x:n,y:x},l?.(),r.current=setTimeout(()=>{e(),o?.(),b(!1)},s)},[e,s,l,o]),d=a.useCallback((n=!0)=>{r.current&&(clearTimeout(r.current),r.current=null),t&&n&&m?.(),b(!1),f.current=null},[t,m]),w=a.useCallback((n,x)=>{if(!f.current)return;const k=10,T=Math.abs(n-f.current.x),E=Math.abs(x-f.current.y);(T>k||E>k)&&d(!0)},[d]),S=a.useCallback(n=>{n.preventDefault(),i(n.clientX,n.clientY)},[i]),y=a.useCallback(()=>{d(!0)},[d]),v=a.useCallback(n=>{t&&w(n.clientX,n.clientY)},[t,w]),C=a.useCallback(()=>{d(!0)},[d]),j=a.useCallback(n=>{if(n.touches.length===1){const x=n.touches[0];i(x.clientX,x.clientY)}},[i]),u=a.useCallback(()=>{d(!0)},[d]),g=a.useCallback(n=>{if(t&&n.touches.length===1){const x=n.touches[0];w(x.clientX,x.clientY)}},[t,w]);return{isPressed:t,handlers:{onMouseDown:S,onMouseUp:y,onMouseMove:v,onMouseLeave:C,onTouchStart:j,onTouchEnd:u,onTouchMove:g}}},K=({isOpen:e,title:c,initialContent:s,onSave:l,onClose:o})=>{const{t:m}=N(),[t,b]=a.useState(s);a.useEffect(()=>{b(s)},[s,e]);const r=()=>{t.trim()&&(l(t.trim()),o())},f=i=>{i.key==="Escape"&&o(),(i.ctrlKey||i.metaKey)&&i.key==="Enter"&&r()};return e?h.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[h.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:o}),h.jsxs("div",{className:"relative bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4 max-h-[80vh] flex flex-col",children:[h.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[h.jsxs("h2",{className:"text-xl font-bold text-primary",children:["✏️ ",c]}),h.jsx("button",{onClick:o,className:"text-muted hover:text-red-600 text-2xl w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors",children:"×"})]}),h.jsxs("div",{className:"flex-1 p-6",children:[h.jsx("textarea",{value:t,onChange:i=>b(i.target.value),onKeyDown:f,placeholder:"내용을 입력하세요...",className:"w-full h-64 p-4 border border-gray-200 rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",autoFocus:!0}),h.jsx("div",{className:"mt-4 text-sm text-muted",children:h.jsx("span",{children:"💡 Ctrl+Enter로 저장, Esc로 취소"})})]}),h.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200",children:[h.jsx("button",{onClick:o,className:"btn btn-secondary",children:"취소"}),h.jsx("button",{onClick:r,disabled:!t.trim(),className:"btn btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:"저장"})]})]})]}):null};async function L(e,c,s){const l=D(s);return l.type===c?(await M(e.id,c,l),{converted:!1}):(await P(e.id,c,l.type,l),{converted:!0,newType:l.type})}async function M(e,c,s){switch(c){case"thought":await p.updateThought(e,{content:s.content});break;case"todo":await p.updateTodo(e,{content:s.content,...s.dueDate&&{dueDate:s.dueDate}});break;case"radiology":await p.updateRadiologyNote(e,{content:s.content,...s.tags&&{tags:s.tags}});break;case"investment":await p.updateInvestment(e,{content:s.content});break}}async function P(e,c,s,l){let o=e;switch(s){case"thought":o=await p.convertToThought(e,c);break;case"todo":o=await p.convertToTodo(e,c);break;case"radiology":o=await p.convertToRadiology(e,c);break;case"investment":o=await p.convertToInvestment(e,c);break}await M(o,s,l)}export{K as E,I as a,L as s,R as u};
