import{u as D,r as n,j as e,d as y}from"./index-D4Z3RT2C.js";const j=(t,l)=>{if(!l.trim())return t;const r=new RegExp(`(${L(l)})`,"gi");return t.replace(r,"<mark>$1</mark>")},L=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),b=(t,l)=>{if(!l.trim())return 0;const r=t.toLowerCase(),c=l.toLowerCase();if(r.includes(c))return r.startsWith(c)?100:r.includes(" "+c)?90:80;const o=c.split(" ").filter(s=>s.length>0);let d=0;return o.forEach(s=>{r.includes(s)&&d++}),o.length>0?d/o.length*70:0},M=(t,l,r,c,o={})=>{if(!c.trim()&&!u(o))return[];const d=[];return(o.type==="all"||o.type==="thought"||!o.type)&&t.forEach(s=>{const i=b(s.content,c);(i>0||u(o))&&f(s,"thought",o)&&d.push({id:s.id,content:s.content,type:"thought",createdAt:s.createdAt,matchScore:i,highlightedContent:j(s.content,c),metadata:{tags:s.tags}})}),(o.type==="all"||o.type==="todo"||!o.type)&&l.forEach(s=>{const i=b(s.content,c);(i>0||u(o))&&f(s,"todo",o)&&d.push({id:s.id,content:s.content,type:"todo",createdAt:s.createdAt,matchScore:i,highlightedContent:j(s.content,c),metadata:{isCompleted:s.isCompleted,priority:s.priority,dueDate:s.dueDate}})}),(o.type==="all"||o.type==="radiology"||!o.type)&&r.forEach(s=>{const i=b(s.content,c);(i>0||u(o))&&f(s,"radiology",o)&&d.push({id:s.id,content:s.content,type:"radiology",createdAt:s.createdAt,matchScore:i,highlightedContent:j(s.content,c),metadata:{tags:s.tags}})}),d.sort((s,i)=>s.matchScore!==i.matchScore?i.matchScore-s.matchScore:i.createdAt.getTime()-s.createdAt.getTime())},u=t=>!!(t.dateRange||t.tags?.length||t.completedStatus&&t.completedStatus!=="all"||t.priority&&t.priority!=="all"),f=(t,l,r)=>{if(r.dateRange){const c=t.createdAt;if(c<r.dateRange.start||c>r.dateRange.end)return!1}if(r.tags?.length){const c="tags"in t?t.tags:[];if(!r.tags.some(d=>c.some(s=>s.toLowerCase().includes(d.toLowerCase()))))return!1}if(l==="todo"&&"isCompleted"in t){const c=t;if(r.completedStatus==="completed"&&!c.isCompleted||r.completedStatus==="pending"&&c.isCompleted||r.priority&&r.priority!=="all"&&c.priority!==r.priority)return!1}return!0};class N{static STORAGE_KEY="search-history";static MAX_HISTORY=10;static getHistory(){const l=localStorage.getItem(this.STORAGE_KEY);return l?JSON.parse(l):[]}static addToHistory(l){if(!l.trim())return;let r=this.getHistory();r=r.filter(c=>c!==l),r.unshift(l),r.length>this.MAX_HISTORY&&(r=r.slice(0,this.MAX_HISTORY)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r))}static clearHistory(){localStorage.removeItem(this.STORAGE_KEY)}}const K=()=>{const{t}=D(),[l,r]=n.useState(""),[c,o]=n.useState([]),[d,s]=n.useState(!1),[i,h]=n.useState({type:"all"}),[v,S]=n.useState([]),[g,A]=n.useState(!1),[w,E]=n.useState([]),[C,_]=n.useState([]),[T,H]=n.useState([]);n.useEffect(()=>{(async()=>{try{const[m,x,F]=await Promise.all([y.getThoughts(),y.getTodos(),y.getRadiologyNotes()]);E(m),_(x),H(F)}catch(m){console.error("Failed to load data for search:",m)}})(),S(N.getHistory())},[]);const R=n.useCallback(()=>{if(!l.trim()&&!p(i)){o([]);return}s(!0);try{const a=M(w,C,T,l,i);o(a),l.trim()&&(N.addToHistory(l),S(N.getHistory()))}catch(a){console.error("Search failed:",a)}finally{s(!1)}},[l,i,w,C,T]);n.useEffect(()=>{const a=setTimeout(R,300);return()=>clearTimeout(a)},[R]);const p=a=>!!(a.type&&a.type!=="all"||a.dateRange||a.tags?.length||a.completedStatus&&a.completedStatus!=="all"||a.priority&&a.priority!=="all"),k=a=>{switch(a){case"thought":return"💭";case"todo":return"✅";case"radiology":return"🏥";default:return"📝"}},$=a=>{switch(a){case"thought":return t("type.thought");case"todo":return t("type.todo");case"radiology":return"Radiology";default:return"Note"}},I=a=>new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(a),O=()=>{r(""),o([]),h({type:"all"})};return e.jsxs("div",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("div",{className:"bg-primary text-white rounded-xl sm:rounded-2xl p-4 sm:p-8 mb-6 sm:mb-8 shadow-lg",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-6",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white/25 rounded-lg mr-3 sm:mr-4 flex items-center justify-center",children:e.jsx("span",{className:"text-xl sm:text-2xl",children:"🔍"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-xl sm:text-3xl font-bold tracking-tight truncate",children:t("search.title")}),e.jsx("p",{className:"opacity-90 text-sm sm:text-lg",children:t("search.subtitle")})]})]}),e.jsxs("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("span",{className:"text-muted",children:"🔍"}),e.jsx("input",{type:"text",value:l,onChange:a=>r(a.target.value),placeholder:t("search.placeholder"),className:"flex-1 text-lg border-0 bg-transparent focus:outline-none placeholder-gray-400 text-primary"}),l&&e.jsx("button",{onClick:O,className:"text-muted hover:text-primary",children:"✕"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>A(!g),className:`btn ${g?"btn-secondary":"btn-outline"} text-sm`,children:[g?"🔽":"🔼"," ",t("search.filters"),p(i)&&e.jsx("span",{className:"ml-2 w-2 h-2 bg-red-500 rounded-full"})]}),e.jsx("div",{className:"text-sm text-muted",children:d?t("search.searching"):`${c.length}${t("search.results")}`})]})]}),g&&e.jsx("div",{className:"bg-white/95 rounded-xl sm:rounded-2xl p-4 sm:p-6 shadow-md mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-2",children:t("search.type")}),e.jsxs("select",{value:i.type||"all",onChange:a=>h({...i,type:a.target.value}),className:"w-full p-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"all",children:t("search.all")}),e.jsx("option",{value:"thought",children:t("search.thoughts")}),e.jsx("option",{value:"todo",children:t("search.tasks")}),e.jsx("option",{value:"radiology",children:t("search.radiology")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-2",children:t("search.status")}),e.jsxs("select",{value:i.completedStatus||"all",onChange:a=>h({...i,completedStatus:a.target.value}),className:"w-full p-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"all",children:t("search.all")}),e.jsx("option",{value:"pending",children:t("search.pending")}),e.jsx("option",{value:"completed",children:t("search.completed")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-primary mb-2",children:t("search.priority")}),e.jsxs("select",{value:i.priority||"all",onChange:a=>h({...i,priority:a.target.value}),className:"w-full p-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/20",children:[e.jsx("option",{value:"all",children:t("search.all")}),e.jsx("option",{value:"high",children:t("search.high")}),e.jsx("option",{value:"medium",children:t("search.medium")}),e.jsx("option",{value:"low",children:t("search.low")})]})]})]})})]}),!l&&v.length>0&&e.jsxs("div",{className:"card mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary mb-3",children:t("search.recent")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((a,m)=>e.jsx("button",{onClick:()=>r(a),className:"badge hover:bg-primary/20 cursor-pointer transition-colors",children:a},m))})]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(a=>e.jsx("div",{className:"card card-hover",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:k(a.type)}),e.jsx("span",{className:"badge",children:$(a.type)})]}),e.jsx("span",{className:"text-xs text-muted",children:I(a.createdAt)})]}),e.jsx("div",{className:"text-base leading-relaxed text-primary mb-3",dangerouslySetInnerHTML:{__html:a.highlightedContent}}),a.metadata&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-auto",children:[a.metadata.isCompleted!==void 0&&e.jsx("span",{className:`badge ${a.metadata.isCompleted?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:a.metadata.isCompleted?"Completed":"Pending"}),a.metadata.priority&&a.metadata.priority!=="medium"&&e.jsx("span",{className:`badge ${a.metadata.priority==="high"?"bg-red-100 text-red-800":a.metadata.priority==="low"?"bg-blue-100 text-blue-800":""}`,children:a.metadata.priority}),a.metadata.tags?.map((m,x)=>e.jsx("span",{className:"badge",children:m},x))]})]})},`${a.type}-${a.id}`))}):l||p(i)?e.jsxs("div",{className:"card text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:t("search.no_results")}),e.jsx("p",{className:"text-muted text-base",children:t("search.no_results_subtitle")})]}):e.jsxs("div",{className:"card text-center",children:[e.jsx("h3",{className:"text-xl font-bold text-primary mb-3",children:t("search.start_searching")}),e.jsx("p",{className:"text-muted text-base",children:t("search.start_searching_subtitle")})]})]})};export{K as SearchPage};
